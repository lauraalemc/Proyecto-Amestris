openapi: 3.0.3
info:
  title: Amestris API
  version: "1.0.0"
  description: API Full-Stack para el Departamento de Alquimia Estatal (Amestris).
servers:
  - url: http://localhost:8080
paths:
  paths:
  /api/v1/materials:
    get:
      summary: Listar materiales
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 50, default: 10 }
        - in: query
          name: offset
          schema: { type: integer, minimum: 0, default: 0 }
        - in: query
          name: q
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items: { $ref: "#/components/schemas/Material" }
                  total:  { type: integer }
                  limit:  { type: integer }
                  offset: { type: integer }
                  q:      { type: string }

  /api/v1/transmutations:
    get:
      summary: Listar transmutaciones
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: limit
          schema: { type: integer, minimum: 1, maximum: 50, default: 10 }
        - in: query
          name: offset
          schema: { type: integer, minimum: 0, default: 0 }
        - in: query
          name: q
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items: { $ref: "#/components/schemas/Transmutation" }
                  total:  { type: integer }
                  limit:  { type: integer }
                  offset: { type: integer }
                  q:      { type: string }

  /api/health:
    get:
      summary: Healthcheck
      responses:
        "200":
          description: OK
  /api/auth/register:
    post:
      summary: Registro de usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
  /api/auth/login:
    post:
      summary: Login de usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
  /api/v1/alchemists:
    get:
      summary: Listar alquimistas
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Alchemist' }
    post:
      summary: Crear alquimista (solo SUPERVISOR)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/Alchemist' }
      responses:
        "201": { description: Created }
  /api/v1/alchemists/{id}:
    get:
      summary: Obtener alquimista
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          schema: { type: integer }
          required: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Alchemist' }
    put:
      summary: Actualizar alquimista (solo SUPERVISOR)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          schema: { type: integer }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/Alchemist' }
      responses:
        "200": { description: OK }
    delete:
      summary: Eliminar alquimista (solo SUPERVISOR)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          schema: { type: integer }
          required: true
      responses:
        "204": { description: No Content }
  /api/v1/missions:
    get:
      summary: Listar misiones
      security: [{ bearerAuth: [] }]
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: '#/components/schemas/Mission' }
    post:
      summary: Crear misi贸n (solo SUPERVISOR)
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/CreateMission' }
      responses:
        "201": { description: Created }
  /api/v1/missions/{id}:
    get:
      summary: Obtener misi贸n
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          schema: { type: integer }
          required: true
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: '#/components/schemas/Mission' }
    put:
      summary: Actualizar misi贸n (solo SUPERVISOR)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          schema: { type: integer }
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: '#/components/schemas/UpdateMission' }
      responses:
        "200": { description: OK }
    delete:
      summary: Eliminar misi贸n (solo SUPERVISOR)
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          schema: { type: integer }
          required: true
      responses:
        "204": { description: No Content }
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    RegisterRequest:
      type: object
      required: [name, email, password]
      properties:
        name: { type: string }
        email: { type: string, format: email }
        password: { type: string, format: password }
        role: { type: string, enum: [ALCHEMIST, SUPERVISOR] }
    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string, format: email }
        password: { type: string, format: password }
    AuthResponse:
      type: object
      properties:
        user:
          type: object
          properties:
            id: { type: integer }
            name: { type: string }
            email: { type: string }
            role: { type: string }
        token: { type: string }
        expiresAt: { type: string, format: date-time }
    Alchemist:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        rank: { type: string }
        specialty: { type: string }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    Mission:
      type: object
      properties:
        id: { type: integer }
        title: { type: string }
        description: { type: string }
        status: { type: string, enum: [PENDING, APPROVED, IN_PROGRESS, COMPLETED, REJECTED] }
        assignedAlchemistId: { type: integer, nullable: true }
        scheduledAt: { type: string, format: date-time, nullable: true }
        completedAt: { type: string, format: date-time, nullable: true }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }
    CreateMission:
      type: object
      required: [title]
      properties:
        title: { type: string }
        description: { type: string }
        assignedAlchemistId: { type: integer, nullable: true }
        scheduledAt: { type: string, format: date-time, nullable: true }
    UpdateMission:
      type: object
      properties:
        title: { type: string, nullable: true }
        description: { type: string, nullable: true }
        status: { type: string, enum: [PENDING, APPROVED, IN_PROGRESS, COMPLETED, REJECTED], nullable: true }
        assignedAlchemistId: { type: integer, nullable: true }
        scheduledAt: { type: string, format: date-time, nullable: true }
        completedAt: { type: string, format: date-time, nullable: true }
security:
  - bearerAuth: []
